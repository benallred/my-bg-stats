<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Board Game Stats</title>
    <script>
        // Apply theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('themePreference') || 'system';
            let theme = 'light';
            if (savedTheme === 'dark') {
                theme = 'dark';
            } else if (savedTheme === 'system') {
                theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>My Board Game Stats</h1>
        <div class="year-filter">
            <div class="filter-group">
                <label for="year-select">Filter by year:</label>
                <select id="year-select">
                    <option value="all">All Time</option>
                    <!-- Years will be populated by JavaScript -->
                </select>
            </div>
            <span id="year-info-badge" class="year-info-badge" style="display: none;"></span>

            <div class="filter-group">
                <label for="base-metric-select">Base Metric:</label>
                <select id="base-metric-select">
                    <option value="hours">Hours</option>
                    <option value="sessions">Sessions</option>
                    <option value="plays">Plays</option>
                </select>
            </div>

            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme"></button>
        </div>
    </header>

    <main>
        <!-- H-Index Metrics Section -->
        <section id="h-index-section" class="stat-section">
            <h2 class="section-heading">H-Index Metrics</h2>
            <div class="section-grid">
                <div class="stat-card clickable" id="h-index" data-stat="h-index">
                    <h3 id="h-index-title">
                        H-Index
                        <svg class="info-icon" id="h-index-info-icon" width="16" height="16" viewBox="0 0 16 16" aria-label="Show h-index information">
                            <circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/>
                            <text x="8" y="11.5" font-size="10" font-weight="bold" text-anchor="middle" fill="currentColor">i</text>
                        </svg>
                    </h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description" id="h-index-description">Games ranked by total hours</p>
                </div>

                <div class="stat-card clickable" id="people-h-index" data-stat="people-h-index">
                    <h3 id="people-h-index-title">
                        People H-Index
                        <svg class="info-icon" id="people-h-index-info-icon" width="16" height="16" viewBox="0 0 16 16" aria-label="Show People H-Index information">
                            <circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/>
                            <text x="8" y="11.5" font-size="10" font-weight="bold" text-anchor="middle" fill="currentColor">i</text>
                        </svg>
                    </h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description" id="people-h-index-description">Games ranked by unique players</p>
                </div>
            </div>
        </section>

        <!-- Collection Statistics Section -->
        <section class="stat-section">
            <h2 class="section-heading">Collection Statistics</h2>
            <div class="section-grid">
                <div class="stat-card clickable" id="total-bgg-entries" data-stat="total-bgg-entries">
                    <h3><span class="stat-label">Total BGG Entries Owned</span></h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description">Includes expansions, expandalones & all copies</p>
                </div>

                <div class="stat-card clickable" id="total-games-owned" data-stat="total-games-owned">
                    <h3><span class="stat-label">Total Games Owned</span></h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description">Base games only</p>
                </div>

                <div class="stat-card clickable" id="total-expansions" data-stat="total-expansions">
                    <h3><span class="stat-label">Total Expansions Owned</span></h3>
                    <div class="stat-value">--</div>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label">Expandalones:</span>
                            <span class="substat-value" id="expandalones-count">--</span>
                        </div>
                        <div class="substat">
                            <span class="substat-label">Expansion-only:</span>
                            <span class="substat-value" id="expansion-only-count">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Play Statistics Section -->
        <section id="play-statistics-section" class="stat-section">
            <h2 class="section-heading">Play Statistics</h2>
            <div class="section-grid">
                <div class="stat-card" id="total-plays">
                    <h3>Total Plays Logged</h3>
                    <div class="stat-value">--</div>
                </div>

                <div class="stat-card clickable" id="unique-games-played" data-stat="unique-games-played">
                    <h3>Unique Games Played</h3>
                    <div class="stat-value">--</div>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label">My games:</span>
                            <span class="substat-value" id="my-games-count">--</span>
                        </div>
                        <div class="substat">
                            <span class="substat-label">Others' games:</span>
                            <span class="substat-value" id="others-games-count">--</span>
                        </div>
                        <div class="substat hidden" id="new-to-me-container">
                            <span class="substat-label">New-to-me:</span>
                            <span class="substat-value" id="new-to-me-count">--</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card clickable" id="total-days-played" data-stat="total-days-played">
                    <h3>Total Days Played</h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description">Unique dates with plays</p>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label">Median:</span>
                            <span class="substat-value" id="daily-session-median">--</span>
                        </div>
                        <div class="substat">
                            <span class="substat-label">Average:</span>
                            <span class="substat-value" id="daily-session-average">--</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card clickable" id="total-play-time" data-stat="total-play-time">
                    <h3>Total Play Time</h3>
                    <div class="stat-value">--</div>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label">In days:</span>
                            <span class="substat-value" id="play-time-days">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Milestone Achievements Section -->
        <section id="milestone-section" class="stat-section">
            <h2 class="section-heading">Milestone Achievements</h2>
            <div class="section-grid">
                <div class="stat-card clickable" id="fives" data-stat="fives">
                    <h3>Fives</h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description">Games with 5-9</p>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label" id="fives-cumulative-label">All games with 5+:</span>
                            <span class="substat-value" id="fives-cumulative">--</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card clickable" id="dimes" data-stat="dimes">
                    <h3>Dimes</h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description">Games with 10-24</p>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label" id="dimes-cumulative-label">All games with 10+:</span>
                            <span class="substat-value" id="dimes-cumulative">--</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card clickable" id="quarters" data-stat="quarters">
                    <h3>Quarters</h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description">Games with 25-99</p>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label" id="quarters-cumulative-label">All games with 25+:</span>
                            <span class="substat-value" id="quarters-cumulative">--</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card clickable" id="centuries" data-stat="centuries">
                    <h3>Centuries</h3>
                    <div class="stat-value">--</div>
                    <p class="stat-description">Games with 100+</p>
                </div>
            </div>
        </section>

        <!-- Social & Locations Section -->
        <section id="social-locations-section" class="stat-section">
            <h2 class="section-heading">Social & Locations</h2>
            <div class="section-grid">
                <div class="stat-card clickable" id="players-card" data-stat="players">
                    <h3>Players</h3>
                    <div class="stat-value">> --</div>
                    <p class="stat-description">Excludes strangers</p>
                </div>

                <div class="stat-card clickable" id="solo-card" data-stat="solo">
                    <h3>Solo</h3>
                    <div class="stat-value">--</div>
                    <div class="stat-substats">
                        <div class="substat">
                            <span class="substat-label">% of total:</span>
                            <span class="substat-value" id="solo-percent">--</span>
                        </div>
                        <div class="substat" id="solo-only-days-container" style="display: none;">
                            <span class="substat-label">Solo-only days:</span>
                            <span class="substat-value" id="solo-only-days">--</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card clickable" id="locations-card" data-stat="locations">
                    <h3>Locations</h3>
                    <div class="stat-value">--</div>
                </div>
            </div>
        </section>

        <!-- Insights Section -->
        <section id="insights-section" class="stat-section">
            <h2 class="section-heading">Insights</h2>
            <div class="section-grid">
                <div class="stat-card clickable insight-card" id="play-next-suggestions" data-stat="play-next-suggestions">
                    <h3>Play Next Suggestions</h3>
                    <p class="stat-description">Recommendations based on play patterns</p>
                </div>

                <div class="stat-card clickable insight-card" id="year-review-card" data-stat="year-review" style="display: none;">
                    <h3>Gaming Year in Review</h3>
                    <p class="stat-description">Interesting facts from the gaming year</p>
                </div>
            </div>
        </section>

        <!-- Detail Section (shown when stat is clicked) -->
        <section id="detail-section" class="detail-section" style="display: none;">
            <div class="detail-header">
                <div class="detail-header-top">
                    <h2 id="detail-title"></h2>
                    <div class="detail-header-buttons">
                        <button id="permalink-btn" class="permalink-btn" title="Copy permalink to clipboard">ðŸ”—</button>
                        <button id="close-detail" class="close-btn">&times;</button>
                    </div>
                </div>
                <div id="detail-stat-summary" class="detail-stat-summary" style="display: none;">
                    <!-- Stat summary will be populated by JavaScript -->
                </div>
            </div>
            <div id="detail-content" class="detail-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </section>

        <!-- Diagnostics Section (always visible, collapsible) -->
        <section id="diagnostics-section" class="diagnostics-section">
            <div class="diagnostics-header" id="diagnostics-header">
                <h2>Diagnostics</h2>
            </div>
            <div id="diagnostics-content" class="diagnostics-content">
                <div class="diagnostics-grid">
                    <div class="diagnostic-card clickable" data-stat="unknown-acquisition-dates">
                        <h3>Unknown Acquisition Dates</h3>
                        <div class="stat-value">--</div>
                        <p class="stat-description">Games missing acquisition date</p>
                    </div>

                    <div class="diagnostic-card clickable" data-stat="never-played">
                        <h3>Never Played</h3>
                        <div class="stat-value">--</div>
                        <p class="stat-description">Owned games with zero plays</p>
                    </div>

                    <div class="diagnostic-card clickable" data-stat="missing-price-paid">
                        <h3>Missing Price Paid</h3>
                        <div class="stat-value">--</div>
                        <p class="stat-description">Owned base games without price</p>
                    </div>
                </div>

                <!-- Diagnostic Detail Section -->
                <section id="diagnostic-detail-section" class="diagnostic-detail-section" style="display: none;">
                    <div class="detail-header">
                        <div class="detail-header-top">
                            <h3 id="diagnostic-detail-title"></h3>
                            <div class="detail-header-buttons">
                                <button id="diagnostic-permalink-btn" class="permalink-btn" title="Copy permalink to clipboard">ðŸ”—</button>
                                <button id="close-diagnostic-detail" class="close-btn">&times;</button>
                            </div>
                        </div>
                        <div id="diagnostic-stat-summary" class="detail-stat-summary" style="display: none;">
                            <!-- Stat summary will be populated by JavaScript -->
                        </div>
                    </div>
                    <div id="diagnostic-detail-content" class="detail-content">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </section>
            </div>
        </section>
    </main>

    <footer>
        <p>Generated from BG Stats export and BoardGameGeek collection</p>
        <p id="last-updated"></p>
    </footer>

    <!-- H-Index Info Modal -->
    <div id="h-index-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Understanding H-Index</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-definition">
                    The h-index measures both <strong>breadth</strong> (number of games) and <strong>depth</strong> (engagement with each game). An h-index of <strong>N</strong> means you have <strong>N games</strong> with at least <strong>N</strong> of the selected metric â€” the point where breadth and depth are equal.
                </p>
                <div class="modal-example" id="h-index-modal-example">
                    <!-- Dynamic content based on selected metric -->
                </div>
                <div class="modal-explanation">
                    <h4>How it's calculated:</h4>
                    <ol>
                        <li>Games are ranked by the selected metric (hours, sessions, or plays)</li>
                        <li>Each game's rank is compared to its metric value</li>
                        <li>The h-index is the largest rank where rank â‰¤ value</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- People H-Index Info Modal -->
    <div id="people-h-index-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Understanding People H-Index</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-definition">
                    The People H-Index, also known as the <strong>Agreeable Ambassador</strong> number, measures how well you spread your gaming across both <strong>games</strong> and <strong>people</strong>. A People H-Index of <strong>N</strong> means you have <strong>N games</strong> that you've played with at least <strong>N unique players</strong> each (excluding yourself).
                </p>
                <div class="modal-example" id="people-h-index-modal-example">
                    <p>For example, if your People H-Index is <strong>5</strong>, you have at least <strong>5 games</strong> where you've played with <strong>5 or more different people</strong> each.</p>
                    <p>To increase it to <strong>6</strong>, you need <strong>1 more game</strong> with 6+ unique players AND <strong>1 more unique player each</strong> for your existing 5 games.</p>
                </div>
                <p class="modal-summary">The higher the number, the more you're sharing diverse gaming experiences with many different people rather than dragging everyone into your favorite game or sticking to the same gaming group.</p>
                <div class="modal-explanation">
                    <h4>How it's calculated:</h4>
                    <ol>
                        <li>Games are ranked by number of unique players (excluding yourself)</li>
                        <li>Each game's rank is compared to its unique player count</li>
                        <li>The People H-Index is the largest rank where rank â‰¤ unique players</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Load our scripts -->
    <script type="module" src="app.js"></script>
</body>
</html>
