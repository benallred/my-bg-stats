<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Board Game Stats</title>
    <script>
        // Apply theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('themePreference') || 'system';
            let theme = 'light';
            if (savedTheme === 'dark') {
                theme = 'dark';
            } else if (savedTheme === 'system') {
                theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-title-row">
            <h1>My Board Game Stats</h1>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme"></button>
        </div>
        <div class="year-filter">
            <div class="filter-group">
                <label for="year-select">Year:</label>
                <select id="year-select">
                    <option value="all">All Time</option>
                    <!-- Years will be populated by JavaScript -->
                </select>
            </div>

            <div class="filter-group">
                <label for="base-metric-select">Metric:</label>
                <select id="base-metric-select">
                    <option value="hours">Hours</option>
                    <option value="sessions">Sessions</option>
                    <option value="plays">Plays</option>
                </select>
            </div>
        </div>
        <div class="header-info-row">
            <span id="year-info-badge" class="year-info-badge" style="display: none;"></span>
            <a href="#" id="year-review-link" class="year-review-link" style="display: none;">Go to <span id="year-review-link-year"></span> Year in Review</a>
        </div>
    </header>

    <main>
        <!-- Dashboard Grid - All widgets in a single responsive grid -->
        <div class="dashboard-grid">
            <!-- H-Index Group -->
            <div class="widget-group-label">H-Index Metrics</div>

            <article class="widget widget--2x1 clickable" id="h-index" data-stat="h-index">
                <div class="widget__title" id="h-index-title">
                    H-Index
                    <svg class="info-icon" id="h-index-info-icon" width="14" height="14" viewBox="0 0 16 16" aria-label="Show h-index information">
                        <circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/>
                        <text x="8" y="11.5" font-size="10" font-weight="bold" text-anchor="middle" fill="currentColor">i</text>
                    </svg>
                </div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="h-index-description">Games ranked by total hours</div>
            </article>

            <article class="widget widget--2x1 clickable" id="people-h-index" data-stat="people-h-index">
                <div class="widget__title" id="people-h-index-title">
                    People H-Index
                    <span class="experimental-badge" data-tooltip="Experimental: This metric is under evaluation and may be modified or removed." onclick="event.stopPropagation();">
                        <svg class="experimental-icon" width="14" height="14" viewBox="0 0 16 16" aria-label="Experimental feature">
                            <path d="M6 2.5V6L3.5 12.5C3.2 13.3 3.8 14 4.5 14H11.5C12.2 14 12.8 13.3 12.5 12.5L10 6V2.5" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 2.5H11" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                            <circle cx="6.5" cy="10.5" r="1" fill="currentColor"/>
                            <circle cx="9" cy="11.5" r="0.7" fill="currentColor"/>
                        </svg>
                    </span>
                    <svg class="info-icon" id="people-h-index-info-icon" width="14" height="14" viewBox="0 0 16 16" aria-label="Show People H-Index information">
                        <circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/>
                        <text x="8" y="11.5" font-size="10" font-weight="bold" text-anchor="middle" fill="currentColor">i</text>
                    </svg>
                </div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="people-h-index-description">Games ranked by unique players</div>
            </article>

            <!-- Collection Group -->
            <div class="widget-group-label">Collection</div>

            <article class="widget widget--1x1 clickable" id="total-games-owned" data-stat="total-games-owned">
                <div class="widget__title"><span class="stat-label">Games Owned</span></div>
                <div class="widget__value">--</div>
                <div class="widget__description">Base games only</div>
            </article>

            <article class="widget widget--1x1 clickable" id="total-expansions" data-stat="total-expansions">
                <div class="widget__title"><span class="stat-label">Expansions</span></div>
                <div class="widget__value">--</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label">Expandalones:</span>
                        <span class="widget__substat-value" id="expandalones-count">--</span>
                    </div>
                    <div class="widget__substat">
                        <span class="widget__substat-label">Expansion-only:</span>
                        <span class="widget__substat-value" id="expansion-only-count">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="total-bgg-entries" data-stat="total-bgg-entries">
                <div class="widget__title"><span class="stat-label">BGG Entries</span></div>
                <div class="widget__value">--</div>
                <div class="widget__description">Includes all copies</div>
            </article>

            <!-- Play Activity Group -->
            <div class="widget-group-label" id="play-statistics-section">Play Activity</div>

            <article class="widget widget--1x1" id="total-plays">
                <div class="widget__title">Plays</div>
                <div class="widget__value">--</div>
            </article>

            <article class="widget widget--1x1 clickable" id="unique-games-played" data-stat="unique-games-played">
                <div class="widget__title">Unique Games</div>
                <div class="widget__value">--</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label">My games:</span>
                        <span class="widget__substat-value" id="my-games-count">--</span>
                    </div>
                    <div class="widget__substat">
                        <span class="widget__substat-label">Others':</span>
                        <span class="widget__substat-value" id="others-games-count">--</span>
                    </div>
                    <div class="widget__substat hidden" id="new-to-me-container">
                        <span class="widget__substat-label">New-to-me:</span>
                        <span class="widget__substat-value" id="new-to-me-count">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="total-days-played" data-stat="total-days-played">
                <div class="widget__title">Days Played</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Unique dates with plays</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label">Median:</span>
                        <span class="widget__substat-value" id="daily-session-median">--</span>
                    </div>
                    <div class="widget__substat">
                        <span class="widget__substat-label">Average:</span>
                        <span class="widget__substat-value" id="daily-session-average">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="total-play-time" data-stat="total-play-time">
                <div class="widget__title">Play Time</div>
                <div class="widget__value">--</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label">In days:</span>
                        <span class="widget__substat-value" id="play-time-days">--</span>
                    </div>
                </div>
            </article>

            <!-- Milestones Group -->
            <div class="widget-group-label" id="milestone-section">Milestones</div>

            <article class="widget widget--1x1 clickable" id="fives" data-stat="fives">
                <div class="widget__title">Fives</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Games with 5-9</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label" id="fives-cumulative-label">All 5+:</span>
                        <span class="widget__substat-value" id="fives-cumulative">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="dimes" data-stat="dimes">
                <div class="widget__title">Dimes</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Games with 10-24</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label" id="dimes-cumulative-label">All 10+:</span>
                        <span class="widget__substat-value" id="dimes-cumulative">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="quarters" data-stat="quarters">
                <div class="widget__title">Quarters</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Games with 25-99</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label" id="quarters-cumulative-label">All 25+:</span>
                        <span class="widget__substat-value" id="quarters-cumulative">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="centuries" data-stat="centuries">
                <div class="widget__title">Centuries</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Games with 100+</div>
            </article>

            <!-- Social Group -->
            <div class="widget-group-label" id="social-locations-section">Social & Locations</div>

            <article class="widget widget--1x1 clickable" id="players-card" data-stat="players">
                <div class="widget__title">Players</div>
                <div class="widget__value">> --</div>
                <div class="widget__description">Excludes strangers</div>
            </article>

            <article class="widget widget--1x1 clickable" id="solo-card" data-stat="solo">
                <div class="widget__title">Solo</div>
                <div class="widget__value">--</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label">% of total:</span>
                        <span class="widget__substat-value" id="solo-percent">--</span>
                    </div>
                    <div class="widget__substat" id="solo-only-days-container" style="display: none;">
                        <span class="widget__substat-label">Solo-only days:</span>
                        <span class="widget__substat-value" id="solo-only-days">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="locations-card" data-stat="locations">
                <div class="widget__title">Locations</div>
                <div class="widget__value">--</div>
            </article>

            <!-- Ratings Group -->
            <div class="widget-group-label" id="ratings-section">Ratings</div>

            <article class="widget widget--1x1 clickable" id="collection-rating" data-stat="collection-rating">
                <div class="widget__title">Avg Collection Rating</div>
                <div class="widget__value">--</div>
                <div class="widget__substats">
                    <div class="widget__substat" id="collection-games-rated-container" style="display: none;">
                        <span class="widget__substat-label">Games rated:</span>
                        <span class="widget__substat-value" id="collection-games-rated-count">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="played-rating" data-stat="played-rating">
                <div class="widget__title">Avg Rating of Played Games</div>
                <div class="widget__value">--</div>
                <div class="widget__substats">
                    <div class="widget__substat" id="played-games-rated-container" style="display: none;">
                        <span class="widget__substat-label">Games rated:</span>
                        <span class="widget__substat-value" id="played-games-rated-count">--</span>
                    </div>
                </div>
            </article>

            <!-- Cost Analysis Group (hidden) -->
            <div class="widget-group-label" id="cost-analysis-section" style="display: none;">Cost Analysis</div>

            <article class="widget widget--1x1 clickable" id="total-cost" data-stat="total-cost" style="display: none;">
                <div class="widget__title">Total Cost</div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="total-cost-description">Sum of all owned copies</div>
            </article>

            <article class="widget widget--1x1 clickable" id="avg-cost-per-metric" data-stat="avg-cost-per-metric" style="display: none;">
                <div class="widget__title">
                    <span id="avg-cost-label">Cost Per Hour</span>
                    <span class="experimental-badge" data-tooltip="Experimental: This metric is under evaluation and may be modified or removed." onclick="event.stopPropagation();">
                        <svg class="experimental-icon" width="12" height="12" viewBox="0 0 16 16" aria-label="Experimental feature">
                            <path d="M6 2.5V6L3.5 12.5C3.2 13.3 3.8 14 4.5 14H11.5C12.2 14 12.8 13.3 12.5 12.5L10 6V2.5" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 2.5H11" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
                            <circle cx="6.5" cy="10.5" r="1" fill="currentColor"/>
                            <circle cx="9" cy="11.5" r="0.7" fill="currentColor"/>
                        </svg>
                    </span>
                </div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="avg-cost-description">Median cost per hour</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label">Game avg:</span>
                        <span class="widget__substat-value" id="avg-cost-game-average">--</span>
                    </div>
                    <div class="widget__substat">
                        <span class="widget__substat-label">Overall:</span>
                        <span class="widget__substat-value" id="avg-cost-overall-rate">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="shelf-of-shame" data-stat="shelf-of-shame" style="display: none;">
                <div class="widget__title">Shelf of Shame</div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="shelf-of-shame-description">Owned games never played</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label">Games:</span>
                        <span class="widget__substat-value" id="shelf-of-shame-count">--</span>
                    </div>
                </div>
            </article>

            <!-- Value Clubs Group (hidden) -->
            <div class="widget-group-label" id="value-clubs-section" style="display: none;">Value Clubs <span class="widget-group-subtitle">(aka "Justifying My Spending")</span></div>

            <article class="widget widget--1x1 clickable" id="five-dollar-club" data-stat="five-dollar-club" style="display: none;">
                <div class="widget__title">$5 Club</div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="five-dollar-club-description">Games at $5 or less per hour</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label" id="five-dollar-cumulative-label">All â‰¤$5:</span>
                        <span class="widget__substat-value" id="five-dollar-cumulative">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="two-fifty-club" data-stat="two-fifty-club" style="display: none;">
                <div class="widget__title">$2.50 Club</div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="two-fifty-club-description">Games at $2.50 or less per hour</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label" id="two-fifty-cumulative-label">All â‰¤$2.50:</span>
                        <span class="widget__substat-value" id="two-fifty-cumulative">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="one-dollar-club" data-stat="one-dollar-club" style="display: none;">
                <div class="widget__title">$1 Club</div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="one-dollar-club-description">Games at $1 or less per hour</div>
                <div class="widget__substats">
                    <div class="widget__substat">
                        <span class="widget__substat-label" id="one-dollar-cumulative-label">All â‰¤$1:</span>
                        <span class="widget__substat-value" id="one-dollar-cumulative">--</span>
                    </div>
                </div>
            </article>

            <article class="widget widget--1x1 clickable" id="fifty-cent-club" data-stat="fifty-cent-club" style="display: none;">
                <div class="widget__title">50Â¢ Club</div>
                <div class="widget__value">--</div>
                <div class="widget__description" id="fifty-cent-club-description">Games at 50Â¢ or less per hour</div>
            </article>

            <!-- Insights Group -->
            <div class="widget-group-label" id="insights-section">Insights</div>

            <article class="widget widget--1x1 widget--feature clickable" id="play-next-suggestions" data-stat="play-next-suggestions">
                <div class="widget__title">Play Next Suggestions</div>
                <div class="widget__description">Recommendations based on play patterns</div>
                <div class="widget__cta">
                    <span class="widget__cta-btn">View suggestions â†’</span>
                </div>
            </article>

            <article class="widget widget--1x1 widget--feature clickable" id="shelf-gallery" data-stat="shelf-gallery">
                <div class="widget__title">Shelf Gallery</div>
                <div class="widget__description">Board game collection photos</div>
                <div class="widget__cta">
                    <span class="widget__cta-btn">View gallery â†’</span>
                </div>
            </article>

            <article class="widget widget--1x1 widget--feature clickable" id="year-review-card" data-stat="year-review" style="display: none;">
                <div class="widget__title">Gaming Year in Review</div>
                <div class="widget__description">Interesting facts from the gaming year</div>
                <div class="widget__cta">
                    <span class="widget__cta-btn">View review â†’</span>
                </div>
            </article>

            <!-- Diagnostics (Hidden) -->
            <div class="widget-group-label" id="diagnostics-section" style="display: none;">
                Diagnostics
            </div>

            <article class="widget widget--1x1 clickable" id="unknown-acquisition-dates" data-stat="unknown-acquisition-dates" style="display: none;">
                <div class="widget__title">Unknown Acquisition Dates</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Games missing acquisition date</div>
            </article>

            <article class="widget widget--1x1 clickable" id="never-played" data-stat="never-played" style="display: none;">
                <div class="widget__title">Never Played</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Owned games with zero plays</div>
            </article>

            <article class="widget widget--1x1 clickable" id="missing-price-paid" data-stat="missing-price-paid" style="display: none;">
                <div class="widget__title">Missing Price Paid</div>
                <div class="widget__value">--</div>
                <div class="widget__description">Owned base games without price</div>
            </article>
        </div>

        <!-- Detail Section (shown when stat is clicked) -->
        <section id="detail-section" class="detail-section" style="display: none;">
            <div class="detail-header">
                <div class="detail-header-top">
                    <h2 id="detail-title"></h2>
                    <div class="detail-header-buttons">
                        <button id="permalink-btn" class="permalink-btn" title="Copy permalink to clipboard">ðŸ”—</button>
                        <button id="close-detail" class="close-btn">&times;</button>
                    </div>
                </div>
                <div id="detail-stat-summary" class="detail-stat-summary" style="display: none;">
                    <!-- Stat summary will be populated by JavaScript -->
                </div>
            </div>
            <div id="detail-content" class="detail-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </section>

    </main>

    <footer>
        <p>Generated from BG Stats export and BoardGameGeek collection</p>
        <p id="last-updated"></p>
    </footer>

    <!-- H-Index Info Modal -->
    <div id="h-index-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Understanding H-Index</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-definition">
                    The h-index measures both <strong>breadth</strong> (number of games) and <strong>depth</strong> (engagement with each game). An h-index of <strong>N</strong> means you have <strong>N games</strong> with at least <strong>N</strong> of the selected metric â€” the point where breadth and depth are equal.
                </p>
                <div class="modal-example" id="h-index-modal-example">
                    <!-- Dynamic content based on selected metric -->
                </div>
                <div class="modal-explanation">
                    <h4>How it's calculated:</h4>
                    <ol>
                        <li>Games are ranked by the selected metric (hours, sessions, or plays)</li>
                        <li>Each game's rank is compared to its metric value</li>
                        <li>The h-index is the largest rank where rank â‰¤ value</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- People H-Index Info Modal -->
    <div id="people-h-index-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Understanding People H-Index</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-definition">
                    The People H-Index, also known as the <strong>Agreeable Ambassador</strong> number, measures how well you spread your gaming across both <strong>games</strong> and <strong>people</strong>. A People H-Index of <strong>N</strong> means you have <strong>N games</strong> that you've played with at least <strong>N unique players</strong> each (excluding yourself).
                </p>
                <div class="modal-example" id="people-h-index-modal-example">
                    <p>For example, if your People H-Index is <strong>5</strong>, you have at least <strong>5 games</strong> where you've played with <strong>5 or more different people</strong> each.</p>
                    <p>To increase it to <strong>6</strong>, you need <strong>1 more game</strong> with 6+ unique players AND <strong>1 more unique player each</strong> for your existing 5 games.</p>
                </div>
                <p class="modal-summary">The higher the number, the more you're sharing diverse gaming experiences with many different people rather than dragging everyone into your favorite game or sticking to the same gaming group.</p>
                <div class="modal-explanation">
                    <h4>How it's calculated:</h4>
                    <ol>
                        <li>Games are ranked by number of unique players (excluding yourself)</li>
                        <li>Each game's rank is compared to its unique player count</li>
                        <li>The People H-Index is the largest rank where rank â‰¤ unique players</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Load our scripts -->
    <script type="module" src="app.js"></script>
</body>
</html>
